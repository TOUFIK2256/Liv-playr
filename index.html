<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SonyLIV 5 - Fixed Aspect Ratio</title>
  
  <!-- Shaka Player Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">
  
  <style>
    body { 
      margin: 0; 
      background: #000; 
      height: 100vh; 
      width: 100vw; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      overflow: hidden; 
    }
    
    /* 16:9 ফিক্সড রেশিও কন্টেইনার */
    .video-container { 
      width: 100%; 
      max-width: 1000px; /* ম্যাক্সিমাম সাইজ */
      aspect-ratio: 16/9; 
      position: relative;
      background: #000;
      box-shadow: 0 0 50px rgba(0,0,0,0.8);
    }

    video { 
      width: 100%; 
      height: 100%; 
      background: #000; 
    }
    
    /* লোডিং স্পিনার ডিজাইন */
    .shaka-spinner-svg {
      display: none;
    }
  </style>
</head>
<body>

  <div class="video-container" data-shaka-player-container>
    <video data-shaka-player autoplay playsinline id="video"></video>
  </div>

<script>
async function initPlayer() {
  const video = document.getElementById('video');
  const ui = video['ui'];
  const controls = ui.getControls();
  const player = controls.getPlayer();

  // ১. কনফিগারেশন (ভিডিও লিংক এবং গিটহাব সোর্স)
  const STREAM_URL = "https://jiotvpllive.cdn.jio.com/bpk-tv/SonyLIV_Sports_5_MOB/WDVLive/index.mpd";
  const GITHUB_M3U = "https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/jstar.m3u";

  // ২. আপনার দেওয়া কী (DRM Keys)
  const DRM_KEYS = {
    "cee8550bf50b569d8ad2ed0c5264f0d2": "565a95f1c332c03534e1e5fcc1ff9a8b"
  };

  player.configure({
    drm: { clearKeys: DRM_KEYS },
    streaming: {
        bufferingGoal: 30, // বাফারিং বাড়ানো হলো ব্ল্যাক স্ক্রিন আটকাতে
        lowLatencyMode: true
    }
  });

  // ৩. কুকি খুঁজে বের করা (GitHub থেকে)
  let finalCookie = "";
  
  try {
    const response = await fetch(GITHUB_M3U);
    const text = await response.text();
    const lines = text.split('\n');
    
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].includes('Star_Sports_HD')) {
        for (let j = i - 1; j >= 0; j--) {
          if (lines[j].includes('cookie')) {
            // কুকি ক্লিন করা হচ্ছে (শুধু ভ্যালুটা নেওয়া হচ্ছে)
            const match = lines[j].match(/"cookie":"([^"]+)"/);
            if (match) {
              finalCookie = match[1];
            }
            break;
          }
        }
        break;
      }
    }
  } catch (e) { console.log("Cookie fetch error"); }

  // ৪. রিকোয়েস্ট ফিল্টার (হেডার ইনজেকশন)
  player.getNetworkingEngine().registerRequestFilter(function(type, request) {
    // Jio/Sony এর জন্য স্পেশাল ইউজার এজেন্ট
    request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";
    request.headers['Referer'] = "https://www.jiotv.com/";
    
    if (finalCookie) {
        request.headers['Cookie'] = finalCookie;
    }
  });

  // ৫. ভিডিও লোড
  try {
    await player.load(STREAM_URL);
    console.log("Player Loaded");
  } catch (e) {
    console.error("Error:", e);
  }
}

document.addEventListener('shaka-ui-loaded', initPlayer);
</script>

</body>
</html>
