<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Shaka Core</title>
    <!-- Core Library Only (No UI Bloat) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: contain; }
    </style>
  </head>
  <body>
    
    <video id="video" width="100%" height="100%" controls autoplay></video>

    <script>
      async function initApp() {
        // Install Polyfills first
        shaka.Polyfill.installAll();

        if (shaka.Player.isBrowserSupported()) {
          initPlayer();
        } else {
          console.error('Browser not supported!');
        }
      }

      async function initPlayer() {
        const video = document.getElementById('video');
        const player = new shaka.Player(video);

        // --- ERROR HANDLING ---
        player.addEventListener('error', (event) => {
           console.error('Error code', event.detail.code, 'object', event.detail);
        });

        // --- GET URL PARAM ---
        const urlParams = new URLSearchParams(window.location.search);
        const manifestUri = urlParams.get('play');

        if(manifestUri) {
            try {
                // --- BUFFER CONFIG (FAST PLAY) ---
                player.configure({
                  streaming: {
                    rebufferingGoal: 2,
                    bufferingGoal: 5,
                    retryParameters: { maxAttempts: 5, baseDelay: 1000, backoffFactor: 2 }
                  }
                });

                await player.load(manifestUri);
                console.log('Video Loaded Successfully');
            } catch (e) {
                console.error('Error loading video', e);
            }
        } else {
            console.log('No "play" parameter found in URL');
        }
      }

      document.addEventListener('DOMContentLoaded', initApp);
    </script>
  </body>
</html>
